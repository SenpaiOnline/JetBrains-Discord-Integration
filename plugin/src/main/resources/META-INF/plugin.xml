<!--
  ~ Copyright 2017-2020 Aljoscha Grebe
  ~ Copyright 2023 Maxim Pavlov
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~   https://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<idea-plugin url="https://github.com/SenpaiOnline/JetBrains-Discord-Integration" require-restart="true">
    <id>online.senpai.intellij.plugins.discord</id>
    <name>Discord Integration</name>
    <vendor email="maxpav137@gmail.com" url="https://github.com/aiscy">Maxim Pavlov</vendor>

    <idea-version since-build="223.7571.182"/>

    <depends>com.intellij.modules.lang</depends>

    <depends optional="true" config-file="git-extension.xml">Git4Idea</depends>

    <applicationListeners>
        <listener
                class="online.senpai.jetbrains.plugins.discord.plugin.development.PreventUnloadingDynamicPluginListener"
                topic="com.intellij.ide.plugins.DynamicPluginListener"/>

        <!--
        <listener
                class="online.senpai.jetbrains.plugins.discord.plugin.time.TimeDynamicPluginListener"
                topic="com.intellij.ide.plugins.DynamicPluginListener"/>
        -->

        <listener
                class="online.senpai.jetbrains.plugins.discord.plugin.time.TimeFileEditorManagerListener"
                topic="com.intellij.openapi.fileEditor.FileEditorManagerListener"/>
    </applicationListeners>

    <extensions defaultExtensionNs="com.intellij">
        <postStartupActivity implementation="online.senpai.jetbrains.plugins.discord.plugin.time.TimeProjectManagerListener"/>

        <notificationGroup displayType="STICKY_BALLOON" id="online.senpai.jetbrains.plugins.discord.notification.project.show"/>
        <notificationGroup displayType="STICKY_BALLOON" id="online.senpai.jetbrains.plugins.discord.notification.update" isLogByDefault="true"/>

        <projectService
                serviceInterface="online.senpai.jetbrains.plugins.discord.plugin.settings.ProjectSettings"
                serviceImplementation="online.senpai.jetbrains.plugins.discord.plugin.settings.impl.ProjectSettingsImpl"/>
        <applicationService
                serviceInterface="online.senpai.jetbrains.plugins.discord.plugin.settings.ApplicationSettings"
                serviceImplementation="online.senpai.jetbrains.plugins.discord.plugin.settings.impl.ApplicationSettingsImpl"/>

        <applicationConfigurable
                groupId="other"
                groupWeight="200"
                displayName="Discord"
                id="discord-application"
                instance="online.senpai.jetbrains.plugins.discord.plugin.settings.ApplicationConfigurable"/>

        <projectConfigurable
                groupId="discord-application"
                groupWeight="200"
                displayName="Project"
                id="discord-project"
                nonDefaultProject="false"
                instance="online.senpai.jetbrains.plugins.discord.plugin.settings.ProjectConfigurable"/>

        <backgroundPostStartupActivity
                implementation="online.senpai.jetbrains.plugins.discord.plugin.notifications.NotificationPostStartupActivity"/>

        <applicationInitializedListener implementation="online.senpai.jetbrains.plugins.discord.plugin.time.TimePreloadingActivity"/>
        <applicationInitializedListener implementation="online.senpai.jetbrains.plugins.discord.plugin.diagnose.DiagnosePreloadingActivity"/>
        <applicationInitializedListener implementation="online.senpai.jetbrains.plugins.discord.plugin.render.RenderPreloadingActivity"/>
    </extensions>

    <actions>
        <group id="DiscordActionGroup"
               text="Discord"
               popup="true"
               icon="/discord/images/logo/blurple.svg">
            <add-to-group group-id="ToolsMenu"/>

            <action id="DiscordActionGroup.ApplicationHideAction"
                    class="online.senpai.jetbrains.plugins.discord.plugin.actions.ApplicationShowAction"/>
            <group id="DiscordActionGroup.ProjectShowAction"
                   class="online.senpai.jetbrains.plugins.discord.plugin.actions.ProjectShowAction"/>

            <separator/>

            <action id="DiscordActionGroup.RenderUpdateAction"
                    class="online.senpai.jetbrains.plugins.discord.plugin.actions.ForceRenderUpdateAction"/>
            <action id="DiscordActionGroup.ReconnectAction"
                    class="online.senpai.jetbrains.plugins.discord.plugin.actions.ForceReconnectAction"/>
        </group>
    </actions>

    <extensionPoints>
        <extensionPoint name="vcsInfo" interface="online.senpai.jetbrains.plugins.discord.plugin.extensions.VcsInfoExtension" dynamic="true"/>
    </extensionPoints>
</idea-plugin>
